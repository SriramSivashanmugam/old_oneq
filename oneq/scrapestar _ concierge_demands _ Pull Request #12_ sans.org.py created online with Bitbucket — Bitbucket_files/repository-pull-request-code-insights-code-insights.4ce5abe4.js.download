!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,n,o){Object.defineProperty(e,t,{get:n,set:o,enumerable:!0,configurable:!0})}var n=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequirecbf3;n.register("4JqUO",(function(o,a){var s;s=o.exports,Object.defineProperty(s,"__esModule",{value:!0,configurable:!0}),t(o.exports,"FREE_REPORTS_LIMIT",(function(){return k})),t(o.exports,"CODE_INSIGHTS_COLLAPSED_LOCALSTORAGE_KEY",(function(){return j})),t(o.exports,"EmptyState",(function(){return w})),t(o.exports,"CodeInsightsCard",(function(){return D})),t(o.exports,"default",(function(){return _}));var r=n("jgze0"),l=n("61szk"),i=n("6tbO4"),u=n("7RIig"),c=n("fatc2"),d=n("c8BGs"),g=n("fXlt9"),p=n("4Rd8x"),f=n("6aCAs"),m=n("7HEfz"),S=n("izGl7"),E=n("btVAK"),h=n("csqQL"),b=n("4BcTK"),I=n("3GKKo"),y=n("3geUT"),C=n("hTK5T"),v=n("gZ4Uf"),R=n("iye20"),x=n("c7TF8"),L=n("69smv"),M=n("96wjm"),P=n("8T5Ac"),A=n("a5e4g"),U=n("acYPb"),T=n("gOHE6");const k=3,j="code.insights.collapsed",w=({isPipelinesEnabled:t,discoveryUrl:n,pipelinesUrl:o})=>{const a=I.useIntl();return e(l).createElement(U.EmptyStateWrapper,null,e(l).createElement(U.EmptyStateImage,{src:e(T),alt:a.formatMessage(A.default.emptyStateImage)}),e(l).createElement(U.EmptyStateMessage,null,a.formatMessage(A.default.emptyStateMessage)," ",e(l).createElement("a",{href:R.default.external.codeInsightsLearnMore,rel:"nofollow"},a.formatMessage(A.default.learnMore))),e(l).createElement(U.EmptyStateLearnMore,null,t?e(l).createElement(m.default,{appearance:"link",href:n,rel:"nofollow",onClick:()=>v.publishUiEvent({action:"clicked",actionSubject:"button",source:"codeInsightsCard",actionSubjectId:"emptyStatePipelinesEnabledButton"})},a.formatMessage(A.default.emptyStateDiscoveryLearnMore)):e(l).createElement(m.default,{appearance:"link",href:o,rel:"nofollow",onClick:()=>v.publishUiEvent({action:"clicked",actionSubject:"button",source:"codeInsightsCard",actionSubjectId:"emptyStatePipelinesDisabledButton"})},a.formatMessage(A.default.emptyStatePipelinesLearnMore))))},O=e=>{const{action:t,actionSubject:n,actionSubjectId:o}=e.payload;v.publishUiEvent({action:t,actionSubject:n,actionSubjectId:o,source:"codeInsightsModal"})},q=()=>v.publishScreenEvent("codeInsightsModal"),D=()=>{const t=I.useIntl(),n=i.useDispatch(),o=i.useSelector(h.getCurrentPullRequest);let a=i.useSelector(h.getCurrentCodeInsightsReports);const s=i.useSelector(h.getCurrentCodeInsightsReportsLoadingState),m=i.useSelector(h.getCurrentCodeInsightsAnnotations),R=i.useSelector(h.getCurrentPullRequestAnnotations),U=i.useSelector(h.getCurrentCodeInsightsAnnotationsLoadingState),T=i.useSelector(L.getIsPipelinesEnabled),D=i.useSelector(L.getIsPipelinesPremium),_=i.useSelector(h.getHasCodeInsightsReportsError),z=!!i.useSelector(C.getCurrentUser),F=i.useSelector(h.getCodeInsightsDiscoveryUrl),K=i.useSelector(h.getPipelinesOnboardingUrl),B=i.useSelector(h.getCodeInsightsAnnotationUrl),G=i.useSelector(L.getIsPipelinesEnabledLoadingState),N=a.some((e=>e.result===b.CodeInsightsResultType.Failed));a=a.map(((e,t)=>({...e,is_locked:!D&&t+1>k})));const[H,W]=l.useState(!1),[Y,Q]=l.useState(-1),J=a[Y]||{},V=a.length;l.useEffect((()=>{z&&G===M.PipelinesEnabledLoadingState.NotLoaded&&n(x.fetchIsPipelinesEnabled())}),[n,z,G]),l.useEffect((()=>{z&&!V&&n(y.fetchCodeInsights()),J.uuid&&!m.length&&n(y.fetchCodeInsightsAnnotations(J.uuid))}),[n,z,m.length,V,J.uuid]);const X=l.useMemo((()=>m[J.uuid]||[]),[m,J.uuid]);return _||!z?null:e(l).createElement(S.AnalyticsListener,{channel:"bitbucket",onEvent:O},e(l).createElement(P.ConnectedExpander,{localStorageKey:j,icon:e(l).createElement(e(c),{label:""}),defaultIsCollapsed:!0,isLoading:s,onChange:e=>{var t,n;return!e.isCollapsed&&v.publishScreenEvent("codeInsightsCard",{reports:V,repositoryUuid:null==o||null===(t=o.destination)||void 0===t||null===(n=t.repository)||void 0===n?void 0:n.uuid,pullRequestId:null==o?void 0:o.id,passedReports:a.filter((e=>e.result===b.CodeInsightsResultType.Passed)).length,failedReports:a.filter((e=>e.result===b.CodeInsightsResultType.Failed)).length})},label:0===V?e(l).createElement(e(l).Fragment,null,t.formatMessage(A.default.sectionAriaLabel)," ",e(l).createElement(g.default,{appearance:"new"},t.formatMessage(A.default.new))):e(l).createElement(u.FormattedMessage,e(r)({},A.default.header,{values:{total:V,formattedCount:e(l).createElement("strong",null,V)}})),sectionAriaLabel:t.formatMessage(A.default.sectionAriaLabel),headingAriaLabel:t.formatMessage(A.default.headingAriaLabel,{total:V}),iconSecondary:N?e(l).createElement(p.default,{position:"bottom",content:t.formatMessage(A.default.labelError)},e(l).createElement(e(d),{label:t.formatMessage(A.default.failedResultIcon),primaryColor:f.colors.R400})):void 0},V?a.map(((t,n)=>e(l).createElement(E.ReportsResultItem,{codeInsightsReport:t,openDialogWithSelectedReport:()=>{W(!0),Q(n),v.publishUiEvent({action:"clicked",actionSubject:"button",source:"codeInsightsCard",actionSubjectId:"selectReportButton"})},key:`code-insights-itemx-${t.uuid}`}))):e(l).createElement(w,{isPipelinesEnabled:T,discoveryUrl:F,pipelinesUrl:K}),H&&e(l).createElement(E.default,{codeInsightsAnnotations:X,currentPullRequestAnnotations:R,codeInsightsReports:a,isLoading:U,selectedReportIndex:Y,setSelectedReport:Q,getSourceUrl:B,closeDialog:()=>W(!1),onLoad:q})))};var _=e(l).memo(D)})),n.register("4BcTK",(function(e,n){var o,a,s,r;t(e.exports,"CodeInsightsResultType",(function(){return o})),(a=o||(o={})).Passed="PASSED",a.Failed="FAILED",a.Pending="PENDING",a.Unknown="UNKNOWN",(r=s||(s={})).Security="SECURITY",r.Coverage="COVERAGE",r.Test="TEST",r.Bug="BUG"})),n.register("acYPb",(function(e,o){t(e.exports,"EmptyStateWrapper",(function(){return r})),t(e.exports,"EmptyStateImage",(function(){return l})),t(e.exports,"EmptyStateMessage",(function(){return i})),t(e.exports,"EmptyStateLearnMore",(function(){return u}));var a=n("eQkAL"),s=n("6aCAs");const r=a.default("div",{target:"e1nkvqf60"})({name:"2imjyh",styles:"display:flex;flex-wrap:wrap;"}),l=a.default("img",{target:"e1nkvqf61"})("margin:",2*s.gridSize(),"px auto;display:block;width:50%;height:50%;"),i=a.default("p",{target:"e1nkvqf62"})("width:100%;margin:0 0 ",2*s.gridSize(),"px;padding:0 ",s.gridSize(),"px;"),u=a.default("div",{target:"e1nkvqf63"})("border-top:1px ",s.colors.N30," solid;box-sizing:border-box;width:100%;height:",5*s.gridSize(),"px;padding-top:",s.gridSize(),"px;display:flex;justify-content:center;align-items:center;")})),n.register("gOHE6",(function(e,t){e.exports=n("a28Ji").getBundleURL("bQKfF")+n("l6272").resolve("i1FqS")}))}();
//# sourceMappingURL=repository-pull-request-code-insights-code-insights.4ce5abe4.js.map
